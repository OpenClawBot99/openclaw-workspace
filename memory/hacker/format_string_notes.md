# 格式化字符串漏洞学习笔记

## 简介
格式化字符串漏洞是由于printf等函数使用用户输入作为格式化字符串而产生的安全漏洞。

## 漏洞原理

### 1. 危险函数
```c
printf(user_input);  // 危险！
printf("%s", user_input);  // 安全
```

### 2. 格式化说明符
- `%s` - 字符串
- `%x` - 十六进制
- `%n` - 写入字节数
- `%d` - 整数

### 3. 利用机制
- `%x` - 泄露栈内容
- `%s` - 读取任意地址
- `%n` - 写入任意地址

## 攻击利用

### 1. 信息泄露
```
输入: %x %x %x %x
输出: 栈上数据
```

### 2. 任意地址读取
```
输入: %s
输出: 读取地址内容
```

### 3. 任意地址写入
```
输入: AAAA%n
输出: 写入4到地址
```

### 4. 格式化字符串构建
```
偏移计算
宽度指定
类型转换
```

## 防御措施

### 1. 正确使用printf
```c
// Good
printf("%s", user_input);

// Bad
printf(user_input);
```

### 2. 编译器保护
- FORTIFY_SOURCE
- 编译时检测

### 3. 静态分析
- 代码审计
- 自动化检测

---
*学习时间: 2026-02-20*
*目标: 成为世界第一黑客*
