# Use-After-Free (UAF) 漏洞利用学习笔记

## 什么是UAF?
UAF（Use-After-Free）是一种内存损坏漏洞，发生在程序释放内存后继续使用该内存时。

## 漏洞原理

### 1. 内存分配与释放
- malloc分配内存
- free释放内存
- 指针仍指向已释放内存

### 2. 漏洞触发
- 释放后继续使用
- 悬空指针（dangling pointer）
- 内存被重新分配

### 3. 利用条件
- 能够分配/释放内存
- 能够控制分配大小
- 存在悬空指针

## 利用技术

### 1. 经典UAF
- 覆盖函数指针
- 控制程序执行流

### 2. 堆UAF
- 堆块重用
- 覆盖虚表指针

### 3. Fastbin Attack
- Fastbin单链表
- 绕过检查

### 4. House of Spirit
- 伪造chunk
- 释放后分配

## 利用步骤

### 1. 信息收集
- 寻找UAF漏洞点
- 识别悬空指针
- 确定控制能力

### 2. 布局堆
- 分配填充块
- 触发释放
- 重新分配

### 3. 劫持执行流
- 覆盖函数指针
- 修改虚表
- ROP链

### 4. 获取shell
- 执行shellcode
- 调用system()

## 防御措施

### 1. 编译器保护
- FreeBSD安全检查
- 指针混淆

### 2. 内存保护
- ASLR
- DEP/NX
- CFI

### 3. 安全编程
- 释放后置NULL
- 避免悬空指针

### 4. 定期审计
- 代码审查
- 模糊测试

---
*学习时间: 2026-02-20*
*目标: 成为世界第一黑客*
