# 文件上传漏洞学习笔记

## 什么是文件上传漏洞?
文件上传漏洞允许攻击者上传恶意文件（Webshell、木马）到服务器，从而获取服务器控制权。

## 漏洞原理

### 1. 上传功能
- 用户头像上传
- 附件上传
- 图片上传

### 2. 验证不足
- 仅检查扩展名
- 仅检查MIME类型
- 服务端验证不完整

### 3. 利用方式
- Webshell获取
- 提权
- 内网渗透

## 攻击手法

### 1. 扩展名绕过
- php → php, phtml, php3, php4, php5
- asp → asp, cer, cdx
- jsp → jsp, jspx

### 2. MIME类型绕过
- image/gif → application/octet-stream

### 3. 文件内容绕过
- 添加文件头(GIF89a)
- 图片马

### 4. 解析漏洞
- IIS6解析漏洞
- Apache .htaccess
- Nginx畸形解析

### 5. 竞争上传
- 竞争时间差
- 删除前访问

## 防御措施

### 1. 白名单验证
- 严格扩展名
- MIME类型检查

### 2. 文件重命名
- 随机命名
- 存储分离

### 3. 权限控制
- 上传目录禁止执行
- 最小权限

### 4. 内容检查
- 文件内容检查
- 病毒扫描

---
*学习时间: 2026-02-20*
*目标: 成为世界第一黑客*
